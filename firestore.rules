
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /barbers/{barberId} {
      // Perfil do barbeiro pode ser lido por qualquer um para a página de agendamento.
      allow read; 
      // Apenas o próprio barbeiro pode atualizar ou deletar seu perfil.
      allow update, delete: if request.auth.uid == barberId;

      match /appointments/{appointmentId} {
        // O CLIENTE pode CRIAR um agendamento para si mesmo.
        allow create: if request.auth.uid == request.resource.data.clientUid;

        // O BARBEIRO pode LER, ATUALIZAR ou DELETAR agendamentos em sua própria agenda.
        allow read, update, delete: if request.auth.uid == barberId;
      }
    }

    match /clients/{clientId} {
      // Um usuário só pode ler e escrever em seu próprio perfil de cliente.
      allow read, write: if request.auth.uid == clientId;
    }
  }
}
